{% extends "base/BaseAdmin.html" %} {% block Titulo %} Dashboard - Vendedor {%
endblock Titulo %} {% block body %}
<style>
  :root {
    --primary-color: #8b4513;
    --secondary-color: #a0522d;
    --light-brown: #d2b48c;
    --background-color: #f8f9fa;
    --green: #28a745;
    --blue: #007bff;
    --red: #dc3545;
    --orange: #fd7e14;
  }

  body,
  .container-fluid {
    overflow: visible !important;
  }

  .card {
    border: none;
    border-radius: 10px;
    box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
    margin-bottom: 1.5rem;
    transition: transform 0.3s;
    overflow: hidden;
  }

  .card:hover {
    transform: translateY(-5px);
  }

  .card img {
    width: 100%;
    height: 180px;
    object-fit: cover;
  }

  .card-header {
    background-color: var(--primary-color);
    color: white;
    padding: 1rem 1.5rem;
    font-weight: 600;
  }

  .card-body {
    padding: 1.5rem;
  }

  .product-info {
    margin-bottom: 1rem;
  }

  .product-info strong {
    color: var(--primary-color);
  }

  .section-title {
    color: var(--primary-color);
    margin: 1.5rem 0 1rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--light-brown);
  }

  .search-bar {
    margin-bottom: 2rem;
  }

  .btn-icon {
    background-color: transparent !important;
    border: none !important;
    padding: 0.3rem 0.5rem;
    transition: color 0.2s;
  }

  .btn-icon:hover {
    filter: brightness(85%);
  }

  .btn-group-icons {
    gap: 0.3rem;
  }

  .btn-icon.green {
    color: var(--green);
  }
  .btn-icon.blue {
    color: var(--blue);
  }
  .btn-icon.red {
    color: var(--red);
  }
  .btn-icon.orange {
    color: var(--orange);
  }

  .modal-product-img {
    width: 100%;
    height: 300px;
    object-fit: cover;
    margin-bottom: 1rem;
    border-radius: 10px;
  }
</style>

<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="container-fluid">
  <h3 class="section-title">OFERTAS</h3>

  <!-- Barra de búsqueda -->
  <div class="search-bar d-flex justify-content-start mb-4">
    <div class="input-group" style="width: 25%">
      <span
        class="input-group-text"
        style="background-color: #fff; border-right: 0"
      >
        <i class="fas fa-search"></i>
      </span>
      <input
        type="text"
        id="searchInput"
        class="form-control"
        placeholder="Buscar"
        style="border-left: 0"
        onkeyup="filterCards()"
      />
    </div>
  </div>

  <!-- Botón para crear nueva oferta -->
  <button
    class="btn btn-primary mb-4"
    data-bs-toggle="modal"
    data-bs-target="#crearOfertaModal"
  >
    <i class="fas fa-plus"></i> Crear Nueva Oferta
  </button>

  <!-- Product Cards -->
  <div class="row" id="productCards">
    {% for producto in productos %}
    <div class="col-md-4 mb-3">
      <div class="card">
        <img src="{{ producto.imagen }}" alt="{{ producto.titulo }}" />
        <div class="card-header">{{ producto.titulo }}</div>
        <div class="card-body">
          <h5 class="card-title">{{ producto.titulo }}</h5>
          <div class="product-info">
            <p><strong>Tipo:</strong> {{ producto.tipoCafe }}</p>
            <p><strong>Variedad:</strong> {{ producto.variedad }}</p>
            <p><strong>Precio por libra:</strong> {{ producto.ofertaLibra }}</p>
          </div>
          <div class="mt-3 d-flex justify-content-end btn-group-icons">
            <button class="btn btn-icon green btn-sm">
              <i class="fas fa-check"></i>
            </button>

            <!-- Editar -->
            <button
              class="btn btn-icon blue btn-sm"
              data-bs-toggle="modal"
              data-bs-target="#editarModal{{ loop.index }}"
            >
              <i class="fas fa-edit"></i>
            </button>

            <!-- Borrar -->
            <form
              action="{{ url_for('ofertas.borrar_oferta', id=producto.id) }}"
              method="POST"
              class="delete-form"
              style="display: inline"
            >
              <button type="submit" class="btn btn-icon red btn-sm">
                <i class="fas fa-trash"></i>
              </button>
            </form>

            <!-- Info -->
            <button
              class="btn btn-icon orange btn-sm"
              data-bs-toggle="modal"
              data-bs-target="#infoModal{{ loop.index }}"
            >
              <i class="fas fa-info-circle"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Detalles -->
    <div
      class="modal fade"
      id="infoModal{{ loop.index }}"
      tabindex="-1"
      aria-labelledby="infoModalLabel{{ loop.index }}"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div
            class="modal-header"
            style="background-color: var(--primary-color); color: #fff"
          >
            <h5 class="modal-title" id="infoModalLabel{{ loop.index }}">
              Detalles del Producto - {{ producto.titulo }}
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Cerrar"
            ></button>
          </div>
          <div class="modal-body">
            <img
              src="{{ producto.imagen }}"
              alt="{{ producto.titulo }}"
              class="modal-product-img"
            />
            <p><strong>Tipo:</strong> {{ producto.tipoCafe }}</p>
            <p><strong>Variedad:</strong> {{ producto.variedad }}</p>
            <p><strong>Precio por libra:</strong> {{ producto.ofertaLibra }}</p>
            <p><strong>Clima:</strong> {{ producto.clima }}</p>
            <p>
              <strong>Fecha de cosecha:</strong> {{ producto.fechaCosecha }}
            </p>
            <p><strong>Altura:</strong> {{ producto.altura }}</p>
            <p>
              <strong>Cantidad de producción:</strong> {{
              producto.cantidadProduccion }}
            </p>
            <p><strong>Estado del grano:</strong> {{ producto.estadoGrano }}</p>
            <p>
              <strong>Proceso de corte:</strong> {{ producto.procesoCorte }}
            </p>
            <p>
              <strong>Lugar seleccionado:</strong> {{ producto.lugarSeleccionado
              }}
            </p>
            <p><strong>Usuario:</strong> {{ producto.userId }}</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary btn-more-info">
              Más información
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Edición -->
    <div
      class="modal fade"
      id="editarModal{{ loop.index }}"
      tabindex="-1"
      aria-labelledby="editarModalLabel{{ loop.index }}"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <form
            action="{{ url_for('ofertas.editar_oferta', id=producto.id) }}"
            method="POST"
          >
            <div
              class="modal-header"
              style="background-color: var(--primary-color); color: #fff"
            >
              <h5 class="modal-title" id="editarModalLabel{{ loop.index }}">
                Editar Oferta - {{ producto.titulo }}
              </h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Cerrar"
              ></button>
            </div>
            <div class="modal-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <label for="titulo{{ loop.index }}" class="form-label"
                    >Título</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="titulo{{ loop.index }}"
                    name="titulo"
                    value="{{ producto.titulo }}"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label for="tipoCafe{{ loop.index }}" class="form-label"
                    >Tipo de café</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="tipoCafe{{ loop.index }}"
                    name="tipoCafe"
                    value="{{ producto.tipoCafe }}"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label for="variedad{{ loop.index }}" class="form-label"
                    >Variedad</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="variedad{{ loop.index }}"
                    name="variedad"
                    value="{{ producto.variedad }}"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label for="clima{{ loop.index }}" class="form-label"
                    >Clima</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="clima{{ loop.index }}"
                    name="clima"
                    value="{{ producto.clima }}"
                  />
                </div>
                <div class="col-md-6">
                  <label for="fechaCosecha{{ loop.index }}" class="form-label"
                    >Fecha de cosecha</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="fechaCosecha{{ loop.index }}"
                    name="fechaCosecha"
                    value="{{ producto.fechaCosecha }}"
                  />
                </div>
                <div class="col-md-6">
                  <label for="altura{{ loop.index }}" class="form-label"
                    >Altura</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="altura{{ loop.index }}"
                    name="altura"
                    value="{{ producto.altura }}"
                  />
                </div>
                <div class="col-md-6">
                  <label
                    for="cantidadProduccion{{ loop.index }}"
                    class="form-label"
                    >Cantidad de producción</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="cantidadProduccion{{ loop.index }}"
                    name="cantidadProduccion"
                    value="{{ producto.cantidadProduccion }}"
                  />
                </div>
                <div class="col-md-6">
                  <label for="estadoGrano{{ loop.index }}" class="form-label"
                    >Estado del grano</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="estadoGrano{{ loop.index }}"
                    name="estadoGrano"
                    value="{{ producto.estadoGrano }}"
                  />
                </div>
                <div class="col-md-6">
                  <label for="procesoCorte{{ loop.index }}" class="form-label"
                    >Proceso de corte</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="procesoCorte{{ loop.index }}"
                    name="procesoCorte"
                    value="{{ producto.procesoCorte }}"
                  />
                </div>
                <div class="col-md-6">
                  <label for="ofertaLibra{{ loop.index }}" class="form-label"
                    >Precio por libra</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="ofertaLibra{{ loop.index }}"
                    name="ofertaLibra"
                    value="{{ producto.ofertaLibra }}"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label for="imagen{{ loop.index }}" class="form-label"
                    >URL de imagen</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="imagen{{ loop.index }}"
                    name="imagen"
                    value="{{ producto.imagen }}"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label
                    for="lugarSeleccionado{{ loop.index }}"
                    class="form-label"
                    >Lugar seleccionado</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="lugarSeleccionado{{ loop.index }}"
                    name="lugarSeleccionado"
                    value="{{ producto.lugarSeleccionado }}"
                  />
                </div>
                <div class="col-md-6">
                  <label for="userId{{ loop.index }}" class="form-label"
                    >Usuario</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="userId{{ loop.index }}"
                    name="userId"
                    value="{{ producto.userId }}"
                  />
                </div>
                <div class="col-12 form-check mt-2">
                  <input
                    type="checkbox"
                    class="form-check-input"
                    id="nuevo{{ loop.index }}"
                    name="nuevo"
                    {%
                    if
                    producto.nuevo
                    %}checked{%
                    endif
                    %}
                  />
                  <label class="form-check-label" for="nuevo{{ loop.index }}"
                    >Nuevo</label
                  >
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-success">
                Actualizar Oferta
              </button>
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Cancelar
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    {% endfor %}
  </div>

  <!-- Modal Crear Oferta -->
  <!-- Modal Crear Oferta -->
  <div
    class="modal fade"
    id="crearOfertaModal"
    tabindex="-1"
    aria-labelledby="crearOfertaModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <form
          action="{{ url_for('ofertas.crear_oferta') }}"
          method="POST"
          enctype="multipart/form-data"
        >
          <div
            class="modal-header"
            style="background-color: var(--primary-color); color: #fff"
          >
            <h5 class="modal-title" id="crearOfertaModalLabel">
              Crear Nueva Oferta
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Cerrar"
            ></button>
          </div>
          <div class="modal-body">
            <div class="row g-3">
              <div class="col-md-6">
                <label for="titulo" class="form-label">Título</label>
                <input
                  type="text"
                  class="form-control"
                  id="titulo"
                  name="titulo"
                  required
                />
              </div>
              <div class="col-md-6">
                <label for="tipoCafe" class="form-label">Tipo de café</label>
                <input
                  type="text"
                  class="form-control"
                  id="tipoCafe"
                  name="tipoCafe"
                  required
                />
              </div>
              <div class="col-md-6">
                <label for="variedad" class="form-label">Variedad</label>
                <input
                  type="text"
                  class="form-control"
                  id="variedad"
                  name="variedad"
                  required
                />
              </div>
              <div class="col-md-6">
                <label for="clima" class="form-label">Clima</label>
                <input
                  type="text"
                  class="form-control"
                  id="clima"
                  name="clima"
                />
              </div>
              <div class="col-md-6">
                <label for="fechaCosecha" class="form-label"
                  >Fecha de cosecha</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="fechaCosecha"
                  name="fechaCosecha"
                />
              </div>
              <div class="col-md-6">
                <label for="altura" class="form-label">Altura</label>
                <input
                  type="text"
                  class="form-control"
                  id="altura"
                  name="altura"
                />
              </div>
              <div class="col-md-6">
                <label for="cantidadProduccion" class="form-label"
                  >Cantidad de producción</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="cantidadProduccion"
                  name="cantidadProduccion"
                />
              </div>
              <div class="col-md-6">
                <label for="estadoGrano" class="form-label"
                  >Estado del grano</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="estadoGrano"
                  name="estadoGrano"
                />
              </div>
              <div class="col-md-6">
                <label for="procesoCorte" class="form-label"
                  >Proceso de corte</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="procesoCorte"
                  name="procesoCorte"
                />
              </div>
              <div class="col-md-6">
                <label for="ofertaLibra" class="form-label"
                  >Precio por libra</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="ofertaLibra"
                  name="ofertaLibra"
                  required
                />
              </div>
              <div class="col-md-6">
                <label for="imagen" class="form-label">Imagen</label>
                <input
                  type="file"
                  class="form-control"
                  id="imagen"
                  name="imagen"
                  accept="image/*"
                />
              </div>
              <div class="col-md-6">
                <label for="lugarSeleccionado" class="form-label"
                  >Lugar seleccionado</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="lugarSeleccionado"
                  name="lugarSeleccionado"
                />
              </div>
              <div class="col-md-6">
                <label for="userId" class="form-label">Usuario</label>
                <input
                  type="text"
                  class="form-control"
                  id="userId"
                  name="userId"
                />
              </div>
              <div class="col-12 form-check mt-2">
                <input
                  type="checkbox"
                  class="form-check-input"
                  id="nuevo"
                  name="nuevo"
                />
                <label class="form-check-label" for="nuevo">Nuevo</label>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-success">Crear Oferta</button>
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script>
    // Filtrar tarjetas
    function filterCards() {
      let input = document.getElementById("searchInput");
      let filter = input.value.toLowerCase();
      let cards = document
        .getElementById("productCards")
        .getElementsByClassName("card");

      for (let i = 0; i < cards.length; i++) {
        let title = cards[i].getElementsByClassName("card-title")[0];
        cards[i].parentElement.style.display = title.innerText
          .toLowerCase()
          .includes(filter)
          ? ""
          : "none";
      }
    }

    // Confirmación de eliminación
    document.querySelectorAll(".delete-form").forEach((form) => {
      form.addEventListener("submit", function (e) {
        e.preventDefault();
        Swal.fire({
          title: "¿Deseas eliminar esta oferta?",
          text: "Esta acción no se puede deshacer",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#d33",
          cancelButtonColor: "#3085d6",
          confirmButtonText: "Sí, eliminar",
          cancelButtonText: "Cancelar",
        }).then((result) => {
          if (result.isConfirmed) {
            form.submit();
          }
        });
      });
    });

    // Redirección al mapa desde "Más información"
    document.querySelectorAll(".btn-more-info").forEach(function (button) {
      button.addEventListener("click", function () {
        window.location.href = "{{ url_for('home.mapa') }}";
      });
    });
  </script>
  {% endblock body %}
</div>
